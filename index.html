<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ</title>
  <style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {font-family:'Segoe UI',Tahoma,sans-serif;
          background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
          min-height:100vh;padding:20px;direction:rtl;}
    .container {max-width:600px;margin:0 auto;background:white;
          border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);overflow:hidden;}
    .header {background:linear-gradient(135deg,#4285F4,#34A853);color:white;padding:30px;text-align:center;}
    .header h1 {font-size:28px;margin-bottom:10px;}
    .header p {font-size:14px;opacity:0.9;}
    .form-container {padding:30px;}
    .form-group {margin-bottom:20px;position:relative;}
    label {display:block;margin-bottom:8px;color:#333;font-weight:600;font-size:14px;}
    input,select {width:100%;padding:12px 15px;border:2px solid #e0e0e0;border-radius:10px;
          font-size:15px;transition:all 0.3s ease;font-family:inherit;}
    input:focus,select:focus {outline:none;border-color:#4285F4;
          box-shadow:0 0 0 3px rgba(66,133,244,0.1);}
    .location-btn {width:100%;padding:12px;background:#34A853;color:white;border:none;
          border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;}
    .submit-btn {width:100%;padding:15px;background:linear-gradient(135deg,#667eea,#764ba2);
          color:white;border:none;border-radius:10px;font-size:18px;font-weight:600;cursor:pointer;}
    .submit-btn:hover {opacity:0.9;}
    .success-message {display:none;text-align:center;padding:30px;}
    .success-message.active {display:block;}
    .success-icon {font-size:60px;color:#34A853;margin-bottom:20px;}
    /* Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ§ØªØ³Ø§Ø¨ */
    .wa-icon img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #25D366;
      padding: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    }
    .wa-icon img:hover { transform: scale(1.1); }
    /* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø±Ù†Ø© */
    .dropdown {
      list-style:none;
      margin:5px 0 0;
      padding:0;
      border:1px solid #ccc;
      border-radius:6px;
      max-height:150px;
      overflow-y:auto;
      background:#fff;
      display:none;
      position:absolute;
      width:100%;
      z-index:999;
    }
    .dropdown li {
      padding:8px 10px;
      cursor:pointer;
    }
    .dropdown li:hover { background:#f0f0f0; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ</h1>
      <p>ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p>
    </div>

    <div class="form-container" id="formContainer">
      <form id="registrationForm">
        <div class="form-group">
          <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨/Ù€Ø© *</label>
          <input type="text" id="studentName" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨/Ù€Ø© Ø§Ù„ÙƒØ§Ù…Ù„">
        </div>
        <div class="form-group">
          <label>Ø³Ø¬Ù„ Ø§Ù„Ø·Ø§Ù„Ø¨/Ù€Ø© *</label>
          <input type="text" id="studentId" required placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ">
        </div>
        <div class="form-group">
          <label>Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„ *</label>
          <input type="tel" id="contactNumber" required placeholder="05xxxxxxxx">
        </div>
        <div class="form-group">
          <label>Ø§Ù„Ù…Ø±Ø­Ù„Ø© *</label>
          <select id="stage" required>
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø©</option>
            <option value="Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
            <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø·</option>
            <option value="Ø«Ø§Ù†ÙˆÙŠ">Ø«Ø§Ù†ÙˆÙŠ</option>
          </select>
        </div>

        <!-- Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³Ø© -->
        <div class="form-group">
          <label>Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³Ø© *</label>
          <select id="studyType" required>
            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</option>
            <option value="Ù…Ù†ØªØ¸Ù…">Ù…Ù†ØªØ¸Ù…</option>
            <option value="Ø§Ù†ØªØ³Ø§Ø¨">Ø§Ù†ØªØ³Ø§Ø¨</option>
            <option value="ØªØ¹Ù„ÙŠÙ… Ø¹Ù† Ø¨Ø¹Ø¯">ØªØ¹Ù„ÙŠÙ… Ø¹Ù† Ø¨Ø¹Ø¯</option>
          </select>
        </div>

        <!-- Ø§Ù„Ù…Ø¯Ø±Ø³Ø© -->
        <div class="form-group">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø© *</label>
          <input type="text" id="schoolName" required placeholder="Ø§Ø®ØªØ± Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¯Ø±Ø³Ø©">
          <ul id="schoolList" class="dropdown"></ul>
        </div>

        <!-- Ø§Ù„Ø­ÙŠ -->
        <div class="form-group">
          <label>Ø§Ù„Ø­ÙŠ *</label>
          <input type="text" id="neighborhood" required placeholder="Ø§Ø®ØªØ± Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¹Ù† Ø­ÙŠ">
          <ul id="neighList" class="dropdown"></ul>
        </div>

        <div class="form-group">
          <label>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ *</label>
          <button type="button" class="location-btn" id="getLocationBtn">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
          <div id="locationStatus"></div>
          <input type="hidden" id="latitude">
          <input type="hidden" id="longitude">
        </div>

        <button type="submit" class="submit-btn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
      </form>
    </div>

    <div class="success-message" id="successMessage">
      <div class="success-icon">âœ…</div>
      <h2>ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!</h2>
      <a href="#" id="whatsappBtn" target="_blank" class="wa-icon">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="ÙˆØ§ØªØ³Ø§Ø¨">
      </a>
    </div>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxY48XwSX3R1_KwZNDK2EFykszZ-9TrlJ16APUOqH0n-g_h2a4SAWptF50vvgHPDR8Frg/exec";

// Ù‚Ø§Ø¦Ù…Ø© Ù…Ø±Ù†Ø©
function setupSearchable(inputId, listId, items, placeholderNew) {
  const input = document.getElementById(inputId);
  const list = document.getElementById(listId);

  input.addEventListener("focus", function() {
    renderList(items, input, list, placeholderNew);
    list.style.display = "block";
  });
  input.addEventListener("input", function() {
    const val = this.value.toLowerCase();
    const filtered = items.filter(x => x.toLowerCase().includes(val));
    renderList(filtered, input, list, placeholderNew);
    list.style.display = "block";
  });
  document.addEventListener("click", e => {
    if (!list.contains(e.target) && e.target !== input) {
      list.style.display = "none";
    }
  });
}
function renderList(arr, input, list, placeholderNew) {
  list.innerHTML = "";
  arr.forEach(txt => {
    const li = document.createElement("li");
    li.textContent = txt;
    li.addEventListener("click", () => {
      input.value = txt;
      list.style.display = "none";
    });
    list.appendChild(li);
  });
  const addNew = document.createElement("li");
  addNew.textContent = "â• Ø£Ø¯Ø®Ù„ Ø¬Ø¯ÙŠØ¯...";
  addNew.addEventListener("click", () => {
    const newVal = prompt("Ø£Ø¯Ø®Ù„ " + placeholderNew + " Ø¬Ø¯ÙŠØ¯:");
    if (newVal && newVal.trim() !== "") {
      input.value = newVal.trim();
      list.style.display = "none";
    }
  });
  list.appendChild(addNew);
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
fetch(API_URL + "?action=getSchools")
  .then(r => r.json())
  .then(schools => setupSearchable("schoolName", "schoolList", schools, "Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©"));
fetch(API_URL + "?action=getNeighborhoods")
  .then(r => r.json())
  .then(neighs => setupSearchable("neighborhood", "neighList", neighs, "Ø§Ø³Ù… Ø§Ù„Ø­ÙŠ"));

// ØªØ­Ù‚Ù‚ ÙˆØ¥Ø±Ø³Ø§Ù„
document.getElementById("registrationForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const nameVal = studentName.value.trim();
  const nameParts = nameVal.split(" ").filter(p => p !== "");
  if (nameParts.length < 4) { alert("âš ï¸ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø±Ø¨Ø§Ø¹ÙŠ."); studentName.focus(); return; }

  const idVal = studentId.value.trim();
  if (!/^[0-9]{10}$/.test(idVal)) { alert("âš ï¸ Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† 10 Ø£Ø±Ù‚Ø§Ù…."); studentId.focus(); return; }

  const phoneVal = contactNumber.value.trim();
  if (!/^05[0-9]{8}$/.test(phoneVal)) { alert("âš ï¸ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05 ÙˆÙŠÙƒÙˆÙ† 10 Ø£Ø±Ù‚Ø§Ù…."); contactNumber.focus(); return; }

  if (!stage.value || !studyType.value || !schoolName.value || !neighborhood.value) {
    alert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©."); return;
  }

  if (!latitude.value || !longitude.value) {
    alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù‚Ø¨Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬."); return;
  }

  const data = {
    studentName: nameVal,
    studentId: idVal,
    contactNumber: phoneVal,
    stage: stage.value,
    studyType: studyType.value,
    schoolName: schoolName.value,
    neighborhood: neighborhood.value,
    latitude: latitude.value,
    longitude: longitude.value
  };

  fetch(API_URL, {method: "POST", body: JSON.stringify(data)})
    .then(r => r.json())
    .then(res => {
      if (res.success) {
        document.getElementById("successMessage").classList.add("active");
        document.getElementById("whatsappBtn").href = res.whatsappLink;
        document.getElementById("formContainer").style.display = "none";
      } else { alert("Ø®Ø·Ø£: " + res.message); }
    })
    .catch(err => alert("Ø®Ø·Ø£: " + err));
});

// ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©
function setLocation(successMsg, errorMsg) {
  navigator.geolocation.getCurrentPosition(
    pos => {
      latitude.value = pos.coords.latitude;
      longitude.value = pos.coords.longitude;
      document.getElementById("locationStatus").innerHTML =
        successMsg + " <br> ğŸ“ Ø¯Ù‚Ø©: " + pos.coords.accuracy.toFixed(1) + " Ù…ØªØ±";
    },
    err => {
      let msg = "âš ï¸ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹";
      if (err.code === 1) msg = "âš ï¸ ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­";
      else if (err.code === 2) msg = "âš ï¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹";
      else if (err.code === 3) msg = "âš ï¸ Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
      document.getElementById("locationStatus").innerHTML = errorMsg + "<br>" + msg;
    },
    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
  );
}

document.getElementById("getLocationBtn").addEventListener("click", () => {
  if (navigator.geolocation) setLocation("âœ“ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠÙ‹Ø§", "âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
});

window.onload = () => {
  if (navigator.geolocation) setLocation("âœ“ ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§", "âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
}
</script>
</body>
</html>
